# dono - Local-First Novel Editor

A local-first novel writing application built with modern web technologies.

## Features

- ğŸ–¥ï¸ **Local-First** - Powered by LiveStore, all data is stored locally in the browser first
- ğŸ“ **Real-time Editing** - Instant response without waiting for network
- ğŸ”„ **Auto Sync** - Automatically syncs to Cloudflare Durable Objects
- ğŸŒ **Cross-Device** - Continue writing on any device after logging in
- ğŸ’¾ **Offline Support** - Works perfectly without internet connection

## Tech Stack

- **LiveStore** - Local-first data layer with automatic sync
- **TanStack Router** - File-based routing with full type safety
- **React** - UI framework
- **TailwindCSS** - Utility-first CSS
- **shadcn/ui** - Reusable UI components
- **Hono** - Backend server framework
- **oRPC** - End-to-end type-safe APIs
- **Cloudflare Workers** - Server runtime
- **Durable Objects** - Persistent storage backend
- **Drizzle** - TypeScript ORM
- **Better-Auth** - Authentication
- **PWA** - Progressive Web App support

## Features

### âœ… Implemented

**Authentication**

- Sign up and login
- Session management

**Novel Management**

- Create/edit/delete novels
- Novel trash bin (soft delete/restore/permanent delete)
- Track recently edited novels
- Auto-generated cover images

**Content Organization**

- Create/delete volumes
- View volume list

**User Interface**

- Dark/light theme toggle
- Responsive design
- PWA support
- Loading states and empty states

### ğŸš§ In Development

- Chapter editor
- Chapter management
- Full data sync implementation

## Getting Started

First, install the dependencies:

```bash
pnpm install
```

## Database Setup

This project uses Cloudflare D1 as the database backend.

1. Update your `.env` file in the `apps/server` directory with the appropriate connection details.

2. Apply the schema to your database:

```bash
pnpm run db:push
```

Then, run the development server:

```bash
pnpm run dev
```

Open [http://localhost:3001](http://localhost:3001) in your browser to see the web application.
The API is running at [http://localhost:3000](http://localhost:3000).

## Project Structure

```
dono/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Frontend application
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/   # TanStack Router pages
â”‚   â”‚   â”‚   â”œâ”€â”€ stores/   # LiveStore definitions
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user/ # User-level store (novels list)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ novel/# Novel-level store (volumes, chapters)
â”‚   â”‚   â”‚   â””â”€â”€ components/# UI components
â”‚   â””â”€â”€ server/           # Backend API
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ do/       # Durable Objects
â”‚           â””â”€â”€ api/      # API endpoints
â””â”€â”€ packages/
    â”œâ”€â”€ api/              # Shared API logic
    â”œâ”€â”€ auth/             # Authentication configuration
    â””â”€â”€ db/               # Database schema
```

## Before Deploying to Cloudflare

When you are ready to deploy your app to Cloudflare Workers, you'll have to make a couple changes.

- Change your url environment variables to match your `*.workers.dev` domains generated by Cloudflare:

```bash
# apps/web/.env
SERVER_URL={your-production-server-domain}

# apps/server/.env
CORS_ORIGIN={your-production-web-domain}
BETTER_AUTH_URL={your-production-server-domain}
```

- In `apps/server/src/lib/auth.ts`, uncomment the `session.cookieCache` and `advanced.crossSubDomainCookies` sections and replace `<your-workers-subdomain>` with your actual workers subdomain. These settings are required to ensure cookies are transferred properly between your web and server domains.

## Deployment (Cloudflare via Alchemy)

- Dev: `pnpm run dev`
- Deploy: `pnpm run deploy`
- Destroy: `pnpm run destroy`

## Available Scripts

- `pnpm run dev` - Start all applications in development mode
- `pnpm run build` - Build all applications
- `pnpm run dev:web` - Start only the web application
- `pnpm run dev:server` - Start only the server
- `pnpm run check-types` - Check TypeScript types across all apps
- `pnpm run db:push` - Push schema changes to database
- `pnpm run db:studio` - Open database studio UI
- `pnpm run check` - Run Oxlint and Oxfmt
- `cd apps/web && pnpm run generate-pwa-assets` - Generate PWA assets
